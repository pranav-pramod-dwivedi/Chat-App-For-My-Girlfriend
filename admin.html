<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Console | Admin Access</title>
    <style>
        body { font-family: monospace; background: #0f0f0f; color: #00ff00; padding: 20px; }
        .hidden { display: none !important; }
        .panel { border: 1px solid #333; padding: 15px; margin-bottom: 20px; background: #161616; }
        .gallery { 
            display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); 
            gap: 15px; max-height: 600px; overflow-y: auto; padding: 10px; border: 1px solid #222;
        }
        .img-card { background: #000; padding: 5px; border: 1px solid #333; text-align: center; }
        .img-card img { width: 100%; border-radius: 4px; }
        .img-card span { font-size: 10px; color: #888; display: block; margin-top: 5px; }
        .action-btn { background: #00ff00; color: #000; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; }
        .danger-btn { background: #440000; color: #ff5555; border: 1px solid #ff5555; cursor: pointer; padding: 10px 20px; }
        input { background: #000; border: 1px solid #00ff00; color: #00ff00; padding: 10px; text-align: center; }
    </style>
</head>
<body>

    <div id="lock-screen" class="panel" style="text-align: center; margin-top: 15vh;">
        <h2>CORE_ACCESS_REQUIRED</h2>
        <input type="password" id="passInput" placeholder="PASSKEY">
        <button onclick="checkAccess()" class="action-btn">LOGIN</button>
    </div>

    <div id="admin-content" class="hidden">
        <h1>SECURITY_LOGS_V4.0</h1>
        
        <div class="panel">
            <h3>IDENTITY_HISTORY_TIMELINE</h3>
            <div style="margin-bottom: 10px;">
                <button onclick="clearHistory()" class="danger-btn">WIPE ALL SECURITY LOGS</button>
            </div>
            <div class="gallery" id="gallery-container">
                </div>
        </div>

        <div class="panel">
            <button onclick="location.href='paths.html'" class="action-btn">BACK TO HUB</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBgQiuJHWCNfS4pIMHFIBpa6VsYrOx_oqU",
            authDomain: "vanshika-chat.firebaseapp.com",
            databaseURL: "https://vanshika-chat-default-rtdb.firebaseio.com",
            projectId: "vanshika-chat",
            appId: "1:564426358988:web:0e95c473fe3922c866c269"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.checkAccess = () => {
            if(document.getElementById('passInput').value === "18") {
                sessionStorage.setItem('admin_auth', 'true');
                showContent();
            } else { alert("DENIED"); }
        };

        function showContent() {
            if(sessionStorage.getItem('admin_auth') === 'true') {
                document.getElementById('lock-screen').classList.add('hidden');
                document.getElementById('admin-content').classList.remove('hidden');
                
                // START MONITORING
                onValue(ref(db, 'security_vault/history'), (snap) => {
                    const container = document.getElementById('gallery-container');
                    container.innerHTML = "";
                    const data = snap.val();
                    if (data) {
                        // Reverse keys so newest is at the top
                        Object.keys(data).reverse().forEach(key => {
                            const entry = data[key];
                            const card = document.createElement('div');
                            card.className = 'img-card';
                            card.innerHTML = `
                                <img src="${entry.img}">
                                <span>${new Date(entry.timestamp).toLocaleTimeString()}</span>
                            `;
                            container.appendChild(card);
                        });
                    } else {
                        container.innerHTML = "<p>NO_LOGS_FOUND</p>";
                    }
                });
            }
        }

        window.clearHistory = () => {
            if(confirm("Delete all security images?")) {
                remove(ref(db, 'security_vault/history'));
            }
        };

        showContent();
    </script>
</body>
</html>